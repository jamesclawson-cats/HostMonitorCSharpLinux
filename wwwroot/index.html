<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Host Monitor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
  <style>
    body { font-family: system-ui, sans-serif; padding: 1rem; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    .up { background: #e8f6e8; }
    .down { background: #fde8e8; color: #900; }
  </style>
</head>
<body>
  <h1>Host Monitor</h1>
  <table id="tbl">
    <thead><tr><th>Host</th><th>Last (ms)</th><th>Avg (ms)</th><th>Loss (%)</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const conn = new signalR.HubConnectionBuilder().withUrl("/monitor").build();
    conn.on("update", snapshot => {
      const tbody = document.querySelector("#tbl tbody");
      tbody.innerHTML = "";
      // snapshot is { host: { host, lastLatencyMs, avgLatencyMs, packetsSent, packetsLost }, ...}
      for (const host in snapshot) {
        const s = snapshot[host];
        const tr = document.createElement("tr");
        tr.className = (s.lastLatencyMs >= 0) ? "up" : "down";
        const last = (s.lastLatencyMs >= 0) ? s.lastLatencyMs : "DOWN";
        const avg = (s.avgLatencyMs || 0).toFixed(1);
        const loss = (s.packetsSent === 0) ? "0" : (s.packetsLost / s.packetsSent * 100).toFixed(1);
        tr.innerHTML = `<td>${s.host}</td><td>${last}</td><td>${avg}</td><td>${loss}</td>`;
        tbody.appendChild(tr);
      }
    });

    conn.start().catch(e => {
      console.error("SignalR start failed:", e);
    });
  </script>
</body>
</html>